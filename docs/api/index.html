<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MycilaJSY: MycilaJSY</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MycilaJSY<span id="projectnumber">&#160;13.0.0</span>
   </div>
   <div id="projectbrief">Arduino / ESP32 library for the JSY1031, JSY-MK-163, JSY-MK-193, JSY-MK-194, JSY-MK-227, JSY-MK-229, JSY-MK-333 families single-phase and three-phase AC bidirectional meters from Shenzhen Jiansiyan Technologies Co, Ltd.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MycilaJSY </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p><a href="https://GitHub.com/mathieucarbou/MycilaJSY/releases/"><img src="https://img.shields.io/github/release/mathieucarbou/MycilaJSY.svg" alt="Latest Release" style="pointer-events: none;" class="inline"/></a> <a href="https://registry.platformio.org/libraries/mathieucarbou/MycilaJSY"><img src="https://badges.registry.platformio.org/packages/mathieucarbou/library/MycilaJSY.svg" alt="PlatformIO Registry" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT" style="pointer-events: none;" class="inline"/></a> <img src="https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg" alt="Contributor Covenant" style="pointer-events: none;" class="inline"/></p>
<p><a href="https://github.com/mathieucarbou/MycilaJSY/actions/workflows/ci.yml"><img src="https://github.com/mathieucarbou/MycilaJSY/actions/workflows/ci.yml/badge.svg" alt="Build" style="pointer-events: none;" class="inline"/></a> <a href="https://GitHub.com/mathieucarbou/MycilaJSY/commit/"><img src="https://badgen.net/github/last-commit/mathieucarbou/MycilaJSY" alt="GitHub latest commit" class="inline"/></a> <a href="https://gitpod.io/#https://github.com/mathieucarbou/MycilaJSY"><img src="https://img.shields.io/badge/Gitpod-Ready--to--Code-blue?logo=gitpod" alt="Gitpod Ready-to-Code" class="inline"/></a></p>
<p>Arduino / ESP32 library for the JSY1031, JSY-MK-163, JSY-MK-193, JSY-MK-194, JSY-MK-227, JSY-MK-229, JSY-MK-333 families single-phase and three-phase AC bidirectional meters from <a href="https://www.jsypowermeter.com">Shenzhen Jiansiyan Technologies Co, Ltd.</a></p>
<ul>
<li>API Documentation</li>
<li>Features</li>
<li>Supported models<ul>
<li>JSY1031 (AC and DC, TTL interface)</li>
<li>JSY-MK-163T (AC, TTL interface)</li>
<li>JSY-MK-193 (AC, RS485 interface)</li>
<li>JSY-MK-194T and JSY-MK-194G (AC, TTL interface)</li>
<li>JSY-MK-227 and JSY-MK-229 (AC and DC, RS485 interface)</li>
<li>JSY-MK-333 and JSY-MK-333G (AC, RS485 interface)</li>
</ul>
</li>
<li>Usage<ul>
<li>Baud rate detection / forcing a baud rate</li>
<li>Destination Address</li>
<li>Model detection / forcing a model</li>
<li>Blocking mode</li>
<li>Non-Blocking mode (async)</li>
<li>Energy reset</li>
<li>Update Baud rate (change speed)</li>
<li>Change device address</li>
<li>Switch AC/DC mode</li>
<li>JSON Support</li>
<li>Debugging</li>
<li>Callbacks</li>
</ul>
</li>
<li>Remote JSY</li>
<li>Zero-Cross Detection</li>
<li>Boxes and 3D models</li>
<li>Performance tests</li>
<li>Reference material</li>
</ul>
<h1>API Documentation</h1>
<p>Go to: <a href="https://mathieu.carbou.me/MycilaJSY/api/index.html">https://mathieu.carbou.me/MycilaJSY/api/index.html</a></p>
<h1>Features</h1>
<ul>
<li>AC/DC mode switch (JSY1031)</li>
<li>Async and blocking mode (configurable core, stack and pause interval)</li>
<li>Automatic baud rate detection</li>
<li>Automatic device address detection</li>
<li>Automatic JSY model detection</li>
<li>Device address: support for multiple devices on the same bus</li>
<li>Energy reset live at runtime</li>
<li>Focus on speed and reactivity with a callback mechanism</li>
<li>Remote support with UDP sender</li>
<li>Support any Serial / TTL (RX/TX port)</li>
<li>Switch bauds rate to any supported speed live at runtime</li>
<li>Zero-Cross detection support with JSY-MK-194G and <a href="https://github.com/mathieucarbou/MycilaPulseAnalyzer">MycilaPulseAnalyzer</a></li>
</ul>
<p>Also read the blog article: <b><a href="https://yasolr.carbou.me/blog/2024-06-26">Everything on le JSY</a></b></p>
<h1>Supported models</h1>
<ul>
<li>JSY1031 (TTL)</li>
<li>JSY-MK-163T (TTL)</li>
<li>JSY-MK-193 (RS485)</li>
<li>JSY-MK-194T (TTL) and JSY-MK-194G (TTL)</li>
<li>JSY-MK-227 (RS485) and JSY-MK-229 (RS485)</li>
<li>JSY-MK-333 (TTL) and JSY-MK-333G (RS485)</li>
</ul>
<h2>JSY1031 (AC and DC, TTL interface)</h2>
<ul>
<li><code>activeEnergy</code></li>
<li><code>activePower</code></li>
<li><code>apparentPower</code></li>
<li><code>current</code></li>
<li><code>frequency</code></li>
<li><code>powerFactor</code></li>
<li><code>reactivePower</code></li>
<li><code>voltage</code></li>
</ul>
<h2>JSY-MK-163T (AC, TTL interface)</h2>
<ul>
<li><code>activeEnergy</code> (sum of <code>activeEnergyImported</code> and <code>activeEnergyReturned</code>)</li>
<li><code>activeEnergyImported</code></li>
<li><code>activeEnergyReturned</code></li>
<li><code>activePower</code></li>
<li><code>apparentPower</code> (calculated)</li>
<li><code>current</code></li>
<li><code>frequency</code></li>
<li><code>powerFactor</code></li>
<li><code>reactivePower</code> (calculate and positive since we do not know the phase shift angle: inductive or capacitive load)</li>
<li><code>voltage</code></li>
</ul>
<h2>JSY-MK-193 (AC, RS485 interface)</h2>
<p>For each channel (1 and 2):</p>
<ul>
<li><code>activeEnergy</code> (sum of <code>activeEnergyImported</code> and <code>activeEnergyReturned</code>)</li>
<li><code>activeEnergyImported</code></li>
<li><code>activeEnergyReturned</code></li>
<li><code>activePower</code></li>
<li><code>apparentPower</code> (calculated)</li>
<li><code>current</code></li>
<li><code>frequency</code></li>
<li><code>powerFactor</code></li>
<li><code>reactivePower</code> (calculate and positive since we do not know the phase shift angle: inductive or capacitive load)</li>
<li><code>voltage</code></li>
</ul>
<h2>JSY-MK-194T and JSY-MK-194G (AC, TTL interface)</h2>
<ul>
<li><code>frequency</code></li>
</ul>
<p>For each channel (1 and 2):</p>
<ul>
<li><code>activeEnergy</code> (sum of <code>activeEnergyImported</code> and <code>activeEnergyReturned</code>)</li>
<li><code>activeEnergyImported</code></li>
<li><code>activeEnergyReturned</code></li>
<li><code>activePower</code></li>
<li><code>apparentPower</code> (calculated)</li>
<li><code>current</code></li>
<li><code>powerFactor</code></li>
<li><code>reactivePower</code> (calculate and positive since we do not know the phase shift angle: inductive or capacitive load)</li>
<li><code>voltage</code></li>
</ul>
<h2>JSY-MK-227 and JSY-MK-229 (AC and DC, RS485 interface)</h2>
<ul>
<li><code>activeEnergy</code></li>
<li><code>activeEnergyImported</code> (positive energy)</li>
<li><code>activeEnergyReturned</code> (negative energy)</li>
<li><code>activePower</code></li>
<li><code>apparentPower</code></li>
<li><code>current</code></li>
<li><code>frequency</code></li>
<li><code>powerFactor</code></li>
<li><code>reactiveEnergy</code></li>
<li><code>reactivePower</code></li>
<li><code>reactiveEnergyImported</code> (positive energy)</li>
<li><code>reactiveEnergyReturned</code> (negative energy)</li>
<li><code>voltage</code></li>
</ul>
<h2>JSY-MK-333 and JSY-MK-333G (AC, RS485 interface)</h2>
<ul>
<li><code>frequency</code></li>
</ul>
<p>For each phase (A, B and C):</p>
<ul>
<li><code>voltage</code></li>
<li><code>current</code></li>
<li><code>activePower</code></li>
<li><code>powerFactor</code></li>
<li><code>apparentPower</code></li>
<li><code>reactivePower</code></li>
<li><code>activeEnergy</code></li>
<li><code>activeEnergyImported</code></li>
<li><code>activeEnergyReturned</code></li>
<li><code>reactiveEnergy</code></li>
<li><code>reactiveEnergyImported</code></li>
<li><code>reactiveEnergyReturned</code></li>
<li><code>apparentEnergy</code></li>
</ul>
<h1>Usage</h1>
<p><b>PIO file:</b></p>
<p>Make sure to use that in your <code>platformio.ini</code>:</p>
<div class="fragment"><div class="line">; Arduino 3.0.x</div>
<div class="line">; platform = https://github.com/pioarduino/platform-espressif32/releases/download/51.03.05/platform-espressif32.zip</div>
<div class="line">; Arduino 3.1.x</div>
<div class="line">platform = https://github.com/pioarduino/platform-espressif32/releases/download/53.03.13/platform-espressif32.zip</div>
<div class="line"> </div>
<div class="line">build_flags =</div>
<div class="line">  -std=c++17</div>
<div class="line">  -std=gnu++17</div>
<div class="line">  -Wall -Wextra</div>
<div class="line"> </div>
<div class="line">build_unflags =</div>
<div class="line">    -std=gnu++11</div>
</div><!-- fragment --><ol type="1">
<li>make sure to use <code>pioarduino</code> platform because PlatformIO provided platforms are not compatible with Arduino Core 3.</li>
<li>C++ 17 is required for mutex</li>
</ol>
<p>Arduino IDE also has a place to set compilation flags.</p>
<p><b>Sample code:</b></p>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="preprocessor">#include &lt;MycilaJSY.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="class_mycila_1_1_j_s_y.html">Mycila::JSY</a> jsy;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="keywordflow">if</span> (jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10b9164b7762c7828af88519b5f09235">read</a>()) {</div>
<div class="line">    <span class="keywordtype">float</span> v = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.single().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>; <span class="comment">// for JSY1031, JSY-163, JSY-227, JSY-229</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> v1 = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.channel1().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>; <span class="comment">// for JSY-193 and JSY-194</span></div>
<div class="line">    <span class="keywordtype">float</span> v2 = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.channel2().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>; <span class="comment">// for JSY-193 and JSY-194</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">float</span> vA = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.phaseA().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>; <span class="comment">// for JSY-333</span></div>
<div class="line">    <span class="keywordtype">float</span> vB = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.phaseB().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>; <span class="comment">// for JSY-333</span></div>
<div class="line">    <span class="keywordtype">float</span> vC = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.phaseC().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>; <span class="comment">// for JSY-333</span></div>
<div class="line">    <span class="keywordtype">float</span> p = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.aggregate().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#a6bffb10f616578af96de9f4eccf1de0b">activePower</a>; <span class="comment">// for JSY-333</span></div>
<div class="line">  }</div>
<div class="line">  delay(4000);</div>
<div class="line">}</div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_1_1_metrics_html_a6bffb10f616578af96de9f4eccf1de0b"><div class="ttname"><a href="class_mycila_1_1_j_s_y_1_1_metrics.html#a6bffb10f616578af96de9f4eccf1de0b">Mycila::JSY::Metrics::activePower</a></div><div class="ttdeci">float activePower</div><div class="ttdoc">Active power in watts (W). Can be positive or negative.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00149">MycilaJSY.h:149</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_1_1_metrics_html_acdd0938d2af9f3f32a429d8df80e484b"><div class="ttname"><a href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">Mycila::JSY::Metrics::voltage</a></div><div class="ttdeci">float voltage</div><div class="ttdoc">Voltage in volts (V).</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00137">MycilaJSY.h:137</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html">Mycila::JSY</a></div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00086">MycilaJSY.h:86</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html_a10b9164b7762c7828af88519b5f09235"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html#a10b9164b7762c7828af88519b5f09235">Mycila::JSY::read</a></div><div class="ttdeci">bool read()</div><div class="ttdoc">Read the JSY values.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00477">MycilaJSY.h:477</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html_a10f4ec84ffaddcd80c643f98c418b72b"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">Mycila::JSY::begin</a></div><div class="ttdeci">void begin(HardwareSerial &amp;serial, int8_t rxPin, int8_t txPin, bool async, uint8_t core=MYCILA_JSY_ASYNC_CORE, uint32_t stackSize=MYCILA_JSY_ASYNC_STACK_SIZE, uint32_t pause=MYCILA_JSY_ASYNC_READ_PAUSE_MS)</div><div class="ttdoc">Initialize the JSY with the given RX and TX pins.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00352">MycilaJSY.h:352</a></div></div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html_a909997057f44db2a195af25b99648be0"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">Mycila::JSY::data</a></div><div class="ttdeci">Data data</div><div class="ttdoc">Access the runtime JSY data.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00574">MycilaJSY.h:574</a></div></div>
</div><!-- fragment --><ul>
<li>Have a look at the examples in the [examples](examples) folder</li>
<li>Read</li>
</ul>
<h2>Baud rate detection / forcing a baud rate</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="comment">// by default, will try to detect the baud rate</span></div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2, Mycila::JSY::BaudRate::UNKNOWN);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Skips baud rate detection and use the given baud rate</span></div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2, Mycila::JSY::BaudRate::BAUD_38400);</div>
</div><!-- fragment --><h2>Destination Address</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="comment">// by default, will send to any device (broadcast)</span></div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2, Mycila::JSY::BaudRate::UNKNOWN, MYCILA_JSY_ADDRESS_BROADCAST);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use the given address</span></div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2, Mycila::JSY::BaudRate::UNKNOWN, 0x01);</div>
</div><!-- fragment --><h2>Model detection / forcing a model</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><span class="comment">// by default, will try to detect the model</span></div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2, Mycila::JSY::BaudRate::UNKNOWN, MYCILA_JSY_ADDRESS_BROADCAST, MYCILA_JSY_MK_UNKNOWN);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Skips model detection and use the given model</span></div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2, Mycila::JSY::BaudRate::UNKNOWN, MYCILA_JSY_MK_227, MYCILA_JSY_MK_194);</div>
</div><!-- fragment --><h2>Blocking mode</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><a class="code hl_class" href="class_mycila_1_1_j_s_y.html">Mycila::JSY</a> jsy;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10b9164b7762c7828af88519b5f09235">read</a>();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// access values</span></div>
<div class="line">  <span class="keywordtype">float</span> v = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.single().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>;</div>
<div class="line"> </div>
<div class="line">  delay(1000);</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Non-Blocking mode (async)</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line"><a class="code hl_class" href="class_mycila_1_1_j_s_y.html">Mycila::JSY</a> jsy;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a10f4ec84ffaddcd80c643f98c418b72b">begin</a>(Serial2, RX2, TX2, <span class="keyword">true</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="comment">// access values</span></div>
<div class="line">  <span class="keywordtype">float</span> v = jsy.<a class="code hl_variable" href="class_mycila_1_1_j_s_y.html#a909997057f44db2a195af25b99648be0">data</a>.single().<a class="code hl_variable" href="class_mycila_1_1_j_s_y_1_1_metrics.html#acdd0938d2af9f3f32a429d8df80e484b">voltage</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Energy reset</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a36ae6809ec283194a65b453b033bd9c9">resetEnergy</a>();</div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html_a36ae6809ec283194a65b453b033bd9c9"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html#a36ae6809ec283194a65b453b033bd9c9">Mycila::JSY::resetEnergy</a></div><div class="ttdeci">bool resetEnergy()</div><div class="ttdoc">Reset the energy counters of the JSY.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00492">MycilaJSY.h:492</a></div></div>
</div><!-- fragment --><h2>Update Baud rate (change speed)</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a48018627cc89e828e8092adeddfe0ddf">setBaudRate</a>(Mycila::JSY::BaudRate::BAUD_38400);</div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html_a48018627cc89e828e8092adeddfe0ddf"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html#a48018627cc89e828e8092adeddfe0ddf">Mycila::JSY::setBaudRate</a></div><div class="ttdeci">bool setBaudRate(BaudRate baudRate)</div><div class="ttdoc">Change the baud rate of the JSY.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00511">MycilaJSY.h:511</a></div></div>
</div><!-- fragment --><h2>Change device address</h2>
<div class="fragment"><div class="line"> ++</div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a3614d9e607f30b8b188b382bc2c60374">setDeviceAddress</a>(0x02);</div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html_a3614d9e607f30b8b188b382bc2c60374"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html#a3614d9e607f30b8b188b382bc2c60374">Mycila::JSY::setDeviceAddress</a></div><div class="ttdeci">bool setDeviceAddress(uint8_t newAddress)</div><div class="ttdoc">Set a new address for a device.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00398">MycilaJSY.h:398</a></div></div>
</div><!-- fragment --><h2>Switch AC/DC mode</h2>
<p>Only for JSY1031:</p>
<div class="fragment"><div class="line"> ++</div>
<div class="line">jsy.<a class="code hl_function" href="class_mycila_1_1_j_s_y.html#a1e72aff0d69a8adf2674b4630e63ad48">setMode</a>(Mycila::JSY::Mode::DC);</div>
<div class="ttc" id="aclass_mycila_1_1_j_s_y_html_a1e72aff0d69a8adf2674b4630e63ad48"><div class="ttname"><a href="class_mycila_1_1_j_s_y.html#a1e72aff0d69a8adf2674b4630e63ad48">Mycila::JSY::setMode</a></div><div class="ttdeci">bool setMode(Mode mode)</div><div class="ttdoc">Set the JSY mode (AC or DC). Some JSY are able to work with either AC or DC current.</div><div class="ttdef"><b>Definition</b> <a href="_mycila_j_s_y_8h_source.html#l00461">MycilaJSY.h:461</a></div></div>
</div><!-- fragment --><h2>JSON Support</h2>
<p>You can activate JSON support by defining <code>-D MYCILA_JSON_SUPPORT</code> in your project and add the <code>ArduinoJson</code> library.</p>
<h2>Debugging</h2>
<p>Set the flag: <code>-D MYCILA_JSY_DEBUG</code> and you will see all the JSY requests and responses.</p>
<h2>Callbacks</h2>
<ul>
<li><code>Callback</code>: called when the JSY has read the data and when a change for any of the metric is detected by the JSY. This is useful to be notified exactly when required. You must check the event type</li>
</ul>
<p><b>Example:</b></p>
<p>Reading a load for 2 second after it is turned on:</p>
<div class="fragment"><div class="line">++</div>
<div class="line"> jsy.setCallback([](<span class="keyword">const</span> Mycila::JSY::EventType eventType) {</div>
<div class="line">   int64_t now = esp_timer_get_time();</div>
<div class="line">   <span class="keywordflow">switch</span> (eventType) {</div>
<div class="line">     <span class="keywordflow">case</span> Mycila::JSY::EventType::EVT_READ:</div>
<div class="line">       Serial.printf(<span class="stringliteral">&quot; - %&quot;</span> PRId64 <span class="stringliteral">&quot; EVT_READ\n&quot;</span>, now);</div>
<div class="line">       <span class="keywordflow">break</span>;</div>
<div class="line">     <span class="keywordflow">case</span> Mycila::JSY::EventType::EVT_CHANGE:</div>
<div class="line">       Serial.printf(<span class="stringliteral">&quot; - %&quot;</span> PRId64 <span class="stringliteral">&quot; EVT_CHANGE: %f W\n&quot;</span>, now, jsy.getActivePower2());</div>
<div class="line">       <span class="keywordflow">break</span>;</div>
<div class="line">     <span class="keywordflow">default</span>:</div>
<div class="line">       Serial.printf(<span class="stringliteral">&quot; - %&quot;</span> PRId64 <span class="stringliteral">&quot; ERR\n&quot;</span>, now);</div>
<div class="line">       <span class="keywordflow">break</span>;</div>
<div class="line">   }</div>
<div class="line"> });</div>
</div><!-- fragment --><p><b>Output example:</b></p>
<div class="fragment"><div class="line">jsy.read() at 4800 bauds:</div>
<div class="line"> - 4406487 EVT_READ</div>
<div class="line"> - 4406577 EVT_CHANGE: 0.000000 W</div>
<div class="line"> - 4576361 EVT_READ</div>
<div class="line"> - 4576452 EVT_CHANGE: 0.567600 W</div>
<div class="line"> - 4746390 EVT_READ</div>
<div class="line"> - 4918004 EVT_READ</div>
<div class="line"> - 4918078 EVT_CHANGE: 238.452896 W</div>
<div class="line"> - 5088016 EVT_READ</div>
<div class="line"> - 5257985 EVT_READ</div>
<div class="line"> - 5258059 EVT_CHANGE: 501.204590 W</div>
<div class="line"> - 5428006 EVT_READ</div>
<div class="line"> - 5597980 EVT_READ</div>
<div class="line"> - 5598055 EVT_CHANGE: 509.064789 W</div>
<div class="line"> - 5767989 EVT_READ</div>
<div class="line"> - 5937958 EVT_READ</div>
<div class="line"> - 5938032 EVT_CHANGE: 507.976410 W</div>
<div class="line"> - 6107979 EVT_READ</div>
<div class="line"> - 6279620 EVT_READ</div>
<div class="line"> - 6279694 EVT_CHANGE: 507.588196 W</div>
<div class="line"> </div>
<div class="line">jsy.read() at 9600 bauds:</div>
<div class="line"> - 7266640 EVT_READ</div>
<div class="line"> - 7266727 EVT_CHANGE: 21.132200 W</div>
<div class="line"> - 7366557 EVT_READ</div>
<div class="line"> - 7474854 EVT_READ</div>
<div class="line"> - 7474928 EVT_CHANGE: 0.847700 W</div>
<div class="line"> - 7577383 EVT_READ</div>
<div class="line"> - 7677342 EVT_READ</div>
<div class="line"> - 7777330 EVT_READ</div>
<div class="line"> - 7877334 EVT_READ</div>
<div class="line"> - 7877408 EVT_CHANGE: 497.609192 W</div>
<div class="line"> - 7977363 EVT_READ</div>
<div class="line"> - 8077326 EVT_READ</div>
<div class="line"> - 8177318 EVT_READ</div>
<div class="line"> - 8177392 EVT_CHANGE: 506.894501 W</div>
<div class="line"> - 8277345 EVT_READ</div>
<div class="line"> - 8377319 EVT_READ</div>
<div class="line"> - 8478147 EVT_READ</div>
<div class="line"> - 8478222 EVT_CHANGE: 506.710205 W</div>
<div class="line"> - 8578164 EVT_READ</div>
<div class="line"> - 8678138 EVT_READ</div>
<div class="line"> - 8778135 EVT_READ</div>
<div class="line"> - 8878132 EVT_READ</div>
<div class="line"> - 8878207 EVT_CHANGE: 506.827393 W</div>
<div class="line"> - 8978150 EVT_READ</div>
<div class="line"> - 9078122 EVT_READ</div>
<div class="line"> - 9178953 EVT_READ</div>
<div class="line"> - 9179027 EVT_CHANGE: 506.932892 W</div>
<div class="line"> </div>
<div class="line">jsy.read() at 19200 bauds:</div>
<div class="line"> - 9820293 EVT_READ</div>
<div class="line"> - 9820383 EVT_CHANGE: 269.228302 W</div>
<div class="line"> - 9880195 EVT_READ</div>
<div class="line"> - 9940570 EVT_READ</div>
<div class="line"> - 10000562 EVT_READ</div>
<div class="line"> - 10060548 EVT_READ</div>
<div class="line"> - 10120538 EVT_READ</div>
<div class="line"> - 10120613 EVT_CHANGE: 19.392099 W</div>
<div class="line"> - 10180976 EVT_READ</div>
<div class="line"> - 10240944 EVT_READ</div>
<div class="line"> - 10300926 EVT_READ</div>
<div class="line"> - 10360912 EVT_READ</div>
<div class="line"> - 10421327 EVT_READ</div>
<div class="line"> - 10421402 EVT_CHANGE: 287.241699 W</div>
<div class="line"> - 10481350 EVT_READ</div>
<div class="line"> - 10541308 EVT_READ</div>
<div class="line"> - 10601290 EVT_READ</div>
<div class="line"> - 10661285 EVT_READ</div>
<div class="line"> - 10721280 EVT_READ</div>
<div class="line"> - 10781686 EVT_READ</div>
<div class="line"> - 10781769 EVT_CHANGE: 506.096008 W</div>
<div class="line"> - 10841700 EVT_READ</div>
<div class="line"> - 10901667 EVT_READ</div>
<div class="line"> - 10961658 EVT_READ</div>
<div class="line"> - 11022060 EVT_READ</div>
<div class="line"> - 11082050 EVT_READ</div>
<div class="line"> - 11082125 EVT_CHANGE: 505.992493 W</div>
<div class="line"> - 11142072 EVT_READ</div>
<div class="line"> - 11202031 EVT_READ</div>
<div class="line"> - 11262031 EVT_READ</div>
<div class="line"> - 11322425 EVT_READ</div>
<div class="line"> - 11382419 EVT_READ</div>
<div class="line"> - 11442409 EVT_READ</div>
<div class="line"> - 11442484 EVT_CHANGE: 505.818298 W</div>
<div class="line"> - 11502441 EVT_READ</div>
<div class="line"> - 11562390 EVT_READ</div>
<div class="line"> - 11622804 EVT_READ</div>
<div class="line"> - 11682791 EVT_READ</div>
<div class="line"> - 11742799 EVT_READ</div>
<div class="line"> - 11742874 EVT_CHANGE: 505.483002 W</div>
<div class="line"> - 11802804 EVT_READ</div>
<div class="line"> </div>
<div class="line">jsy.read() at 38400 bauds:</div>
<div class="line"> - 13017424 EVT_READ</div>
<div class="line"> - 13017515 EVT_CHANGE: 11.180500 W</div>
<div class="line"> - 13067332 EVT_READ</div>
<div class="line"> - 13067423 EVT_CHANGE: 0.000000 W</div>
<div class="line"> - 13117320 EVT_READ</div>
<div class="line"> - 13157496 EVT_READ</div>
<div class="line"> - 13207482 EVT_READ</div>
<div class="line"> - 13247472 EVT_READ</div>
<div class="line"> - 13287678 EVT_READ</div>
<div class="line"> - 13337675 EVT_READ</div>
<div class="line"> - 13377664 EVT_READ</div>
<div class="line"> - 13417866 EVT_READ</div>
<div class="line"> - 13417941 EVT_CHANGE: 320.179688 W</div>
<div class="line"> - 13467890 EVT_READ</div>
<div class="line"> - 13517859 EVT_READ</div>
<div class="line"> - 13557844 EVT_READ</div>
<div class="line"> - 13598042 EVT_READ</div>
<div class="line"> - 13648037 EVT_READ</div>
<div class="line"> - 13688036 EVT_READ</div>
<div class="line"> - 13728237 EVT_READ</div>
<div class="line"> - 13728312 EVT_CHANGE: 503.697113 W</div>
<div class="line"> - 13778253 EVT_READ</div>
<div class="line"> - 13828221 EVT_READ</div>
<div class="line"> - 13868215 EVT_READ</div>
<div class="line"> - 13908412 EVT_READ</div>
<div class="line"> - 13958400 EVT_READ</div>
<div class="line"> - 13998398 EVT_READ</div>
<div class="line"> - 14046098 EVT_READ</div>
<div class="line"> - 14046173 EVT_CHANGE: 507.100891 W</div>
<div class="line"> - 14088424 EVT_READ</div>
<div class="line"> - 14128377 EVT_READ</div>
<div class="line"> - 14168579 EVT_READ</div>
<div class="line"> - 14208568 EVT_READ</div>
<div class="line"> - 14248575 EVT_READ</div>
<div class="line"> - 14288771 EVT_READ</div>
<div class="line"> - 14328769 EVT_READ</div>
<div class="line"> - 14376462 EVT_READ</div>
<div class="line"> - 14376537 EVT_CHANGE: 507.294708 W</div>
<div class="line"> - 14418996 EVT_READ</div>
<div class="line"> - 14468947 EVT_READ</div>
<div class="line"> - 14508941 EVT_READ</div>
<div class="line"> - 14548930 EVT_READ</div>
<div class="line"> - 14589151 EVT_READ</div>
<div class="line"> - 14629129 EVT_READ</div>
<div class="line"> - 14669129 EVT_READ</div>
<div class="line"> - 14709325 EVT_READ</div>
<div class="line"> - 14709400 EVT_CHANGE: 507.153198 W</div>
<div class="line"> - 14759359 EVT_READ</div>
<div class="line"> - 14799311 EVT_READ</div>
<div class="line"> - 14839513 EVT_READ</div>
<div class="line"> - 14889501 EVT_READ</div>
<div class="line"> - 14929499 EVT_READ</div>
<div class="line"> - 14969706 EVT_READ</div>
</div><!-- fragment --><h1>Remote JSY</h1>
<p>The JSY can be used connected to an ESP32 to send the JSY data several times per second to a remote server through UDP. Both devices needs to be connected to the same network and UDP packets must be allowed.</p>
<p>Screenshot of the ESP32 running the JSY app called the <code>Sender</code>:</p>
<p><img src="https://github.com/mathieucarbou/MycilaJSY/assets/61346/3066bf12-31d5-45de-9303-d810f14731d0" alt="" class="inline"/></p>
<p><a href="https://github.com/mathieucarbou/MycilaJSY/tree/main/examples/RemoteUDP">Click here for the download and installation instructions of the JSY Remote UDP Sender</a></p>
<p><b>Wiring for JSY boards with 2 channels:</b></p>
<ul>
<li>Channel 1 (CT1): anything</li>
<li>Channel 2 (CT2): the grid should go through it</li>
</ul>
<p>Reason is that on some JSY, channel 1 is a tore on the board while channel 2 is always a clamp. This is easier to put a clamp around the grid wire.</p>
<h1>Zero-Cross Detection</h1>
<p>The JSY-MK-194G has a zero-cross detection feature which signals on the Zx pin when the current crosses zero. This feature is really useful to create Solr Routers like <a href="https://yasolr.carbou.me">YaSolR</a>.</p>
<p>The <a href="https://github.com/mathieucarbou/MycilaPulseAnalyzer">MycilaPulseAnalyzer</a> library supports many ZC detection methods including the JSY-MK-194G.</p>
<p><a href="https://mathieu.carbou.me/MycilaPulseAnalyzer/assets/Oscillo_JSY-MK-194G_ZC_5ms.png"><img src="https://mathieu.carbou.me/MycilaPulseAnalyzer/assets/Oscillo_JSY-MK-194G_ZC_5ms.png" alt="" class="inline"/></a></p>
<h1>Boxes and 3D models</h1>
<p>You can make (print) a box or buy one, and then append a SSR Din Rail clip at the bottom:</p>
<ul>
<li><a href="https://fr.aliexpress.com/item/1005005490499647.html">https://fr.aliexpress.com/item/1005005490499647.html</a></li>
</ul>
<p><b>Cases for the JSY-MK-194 T</b></p>
<ul>
<li><a href="https://www.thingiverse.com/thing:6003867">https://www.thingiverse.com/thing:6003867</a></li>
</ul>
<p><b>Cases for the JSY-MK-194 G</b></p>
<ul>
<li><a href="https://fr.aliexpress.com/item/1005002467813588.html">https://fr.aliexpress.com/item/1005002467813588.html</a></li>
<li><a href="https://www.printables.com/model/72839-customizable-parametric-stable-and-waterproof-elec">https://www.printables.com/model/72839-customizable-parametric-stable-and-waterproof-elec</a></li>
<li><a href="https://www.thingiverse.com/thing:4921568">https://www.thingiverse.com/thing:4921568</a></li>
<li><a href="https://www.thingiverse.com/thing:2252270">https://www.thingiverse.com/thing:2252270</a></li>
</ul>
<p>Here is the STL file I use for the JSY-MK-194G box mounted on a DIN rail: <a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-194G.stl">JSY-MK-194G.stl</a> which was created thanks to <a href="https://www.printables.com/model/72839-customizable-parametric-stable-and-waterproof-elec">this parametric model</a> with these parameters:</p>
<div class="fragment"><div class="line">ShowBottom                = true;</div>
<div class="line">ShowTop                   = true;</div>
<div class="line">DistanceBetweenObjects    = 10;</div>
<div class="line">ShowCaseAssembled         = false;</div>
<div class="line"> </div>
<div class="line">Caselength                = 90;</div>
<div class="line">CaseWidth                 = 60;</div>
<div class="line">CaseHeight                = 42;</div>
<div class="line"> </div>
<div class="line">BottomTopThickness        = 2.0;</div>
<div class="line"> </div>
<div class="line">CountersinkScrew          = 3.0;</div>
<div class="line"> </div>
<div class="line">ShowDeviceHolder         = true;</div>
<div class="line">ScrewHoleDiameter        = 2.6;</div>
<div class="line">ScrewCylinderDiameter    = 7;</div>
<div class="line">ScrewCylinderHeight      = 7.0;</div>
<div class="line">DeviceHolder_X_Distance  = 58;</div>
<div class="line">DeviceHolder_y_Distance  = 42;</div>
<div class="line">Offset_X                 = 0;</div>
<div class="line">Offset_Y                 = 0;</div>
<div class="line">ShowSideWallHoles        = true;</div>
<div class="line">SideWallHolesOn_X        = false;</div>
<div class="line">CountOfSideWallHoles     = 2;</div>
<div class="line">SideWallHoleDiameter     = 20;</div>
<div class="line">SiedWallHoleOffset_Z     = 0;</div>
</div><!-- fragment --><p>| <a href="https://mathieu.carbou.me/MycilaJSY/jsy-box-1.jpeg"><img src="https://mathieu.carbou.me/MycilaJSY/jsy-box-1.jpeg" alt="" class="inline"/></a> | <a href="https://mathieu.carbou.me/MycilaJSY/jsy-box-2.jpeg"><img src="https://mathieu.carbou.me/MycilaJSY/jsy-box-2.jpeg" alt="" class="inline"/></a> | <a href="https://mathieu.carbou.me/MycilaJSY/jsy-box-3.jpeg"><img src="https://mathieu.carbou.me/MycilaJSY/jsy-box-3.jpeg" alt="" class="inline"/></a> |</p>
<h1>Performance tests</h1>
<p>Here are below some test results for the JSY at different baud rates for 50 consecutive reads on a nominal load of about 650W, controlled with a random SSR relay (0-100%).</p>
<p>You can run the <code>PerfTests</code> from the examples.</p>
<p><b>PerfTest1</b></p>
<div class="fragment"><div class="line">jsy.read() at 4800 bauds:</div>
<div class="line"> - Errors: 0</div>
<div class="line"> - Average read time: 170583 us</div>
<div class="line"> - Min read time: 168330 us</div>
<div class="line"> - Max read time: 178322 us</div>
<div class="line"> </div>
<div class="line">jsy.read() at 9600 bauds:</div>
<div class="line"> - Errors: 0</div>
<div class="line"> - Average read time: 100525 us</div>
<div class="line"> - Min read time: 99897 us</div>
<div class="line"> - Max read time: 108333 us</div>
<div class="line"> </div>
<div class="line">jsy.read() at 19200 bauds:</div>
<div class="line"> - Errors: 0</div>
<div class="line"> - Average read time: 60078 us</div>
<div class="line"> - Min read time: 59568 us</div>
<div class="line"> - Max read time: 60413 us</div>
<div class="line"> </div>
<div class="line">jsy.read() at 38400 bauds:</div>
<div class="line"> - Errors: 0</div>
<div class="line"> - Average read time: 41248 us</div>
<div class="line"> - Min read time: 39894 us</div>
<div class="line"> - Max read time: 49936 us</div>
</div><!-- fragment --><p><b>PerfTest2</b></p>
<div class="fragment"><div class="line">jsy.read() at 4800 bauds:</div>
<div class="line"> - ROUND: 1</div>
<div class="line">   * Load Detection time: 169670 us (1 reads)</div>
<div class="line">   * Ramp up time: 347890 us (2 reads)</div>
<div class="line">   * Ramp down time: 1363108 us (8 reads)</div>
<div class="line"> - ROUND: 2</div>
<div class="line">   * Load Detection time: 679860 us (4 reads)</div>
<div class="line">   * Ramp up time: 1191511 us (7 reads)</div>
<div class="line">   * Ramp down time: 1531476 us (9 reads)</div>
<div class="line"> - ROUND: 3</div>
<div class="line">   * Load Detection time: 679867 us (4 reads)</div>
<div class="line">   * Ramp up time: 1198192 us (7 reads)</div>
<div class="line">   * Ramp down time: 1363164 us (8 reads)</div>
<div class="line"> - ROUND: 4</div>
<div class="line">   * Load Detection time: 681522 us (4 reads)</div>
<div class="line">   * Ramp up time: 1191498 us (7 reads)</div>
<div class="line">   * Ramp down time: 1531493 us (9 reads)</div>
<div class="line"> </div>
<div class="line">jsy.read() at 9600 bauds:</div>
<div class="line"> - ROUND: 1</div>
<div class="line">   * Load Detection time: 299799 us (3 reads)</div>
<div class="line">   * Ramp up time: 1100600 us (11 reads)</div>
<div class="line">   * Ramp down time: 1501484 us (15 reads)</div>
<div class="line"> - ROUND: 2</div>
<div class="line">   * Load Detection time: 700694 us (7 reads)</div>
<div class="line">   * Ramp up time: 1101510 us (11 reads)</div>
<div class="line">   * Ramp down time: 1501474 us (15 reads)</div>
<div class="line"> - ROUND: 3</div>
<div class="line">   * Load Detection time: 400709 us (4 reads)</div>
<div class="line">   * Ramp up time: 800693 us (8 reads)</div>
<div class="line">   * Ramp down time: 1201502 us (12 reads)</div>
<div class="line"> - ROUND: 4</div>
<div class="line">   * Load Detection time: 700710 us (7 reads)</div>
<div class="line">   * Ramp up time: 800693 us (8 reads)</div>
<div class="line">   * Ramp down time: 1200678 us (12 reads)</div>
<div class="line"> </div>
<div class="line">jsy.read() at 19200 bauds:</div>
<div class="line"> - ROUND: 1</div>
<div class="line">   * Load Detection time: 362264 us (6 reads)</div>
<div class="line">   * Ramp up time: 1082982 us (18 reads)</div>
<div class="line">   * Ramp down time: 1261343 us (21 reads)</div>
<div class="line"> - ROUND: 2</div>
<div class="line">   * Load Detection time: 300247 us (5 reads)</div>
<div class="line">   * Ramp up time: 1020957 us (17 reads)</div>
<div class="line">   * Ramp down time: 1261351 us (21 reads)</div>
<div class="line"> - ROUND: 3</div>
<div class="line">   * Load Detection time: 360253 us (6 reads)</div>
<div class="line">   * Ramp up time: 1081379 us (18 reads)</div>
<div class="line">   * Ramp down time: 1260926 us (21 reads)</div>
<div class="line"> - ROUND: 4</div>
<div class="line">   * Load Detection time: 300273 us (5 reads)</div>
<div class="line">   * Ramp up time: 1020982 us (17 reads)</div>
<div class="line">   * Ramp down time: 1261351 us (21 reads)</div>
<div class="line"> </div>
<div class="line">jsy.read() at 38400 bauds:</div>
<div class="line"> - ROUND: 1</div>
<div class="line">   * Load Detection time: 468076 us (11 reads)</div>
<div class="line">   * Ramp up time: 840729 us (20 reads)</div>
<div class="line">   * Ramp down time: 1291332 us (32 reads)</div>
<div class="line"> - ROUND: 2</div>
<div class="line">   * Load Detection time: 330244 us (8 reads)</div>
<div class="line">   * Ramp up time: 1020971 us (25 reads)</div>
<div class="line">   * Ramp down time: 1281353 us (32 reads)</div>
<div class="line"> - ROUND: 3</div>
<div class="line">   * Load Detection time: 330047 us (8 reads)</div>
<div class="line">   * Ramp up time: 1030773 us (25 reads)</div>
<div class="line">   * Ramp down time: 1301323 us (32 reads)</div>
<div class="line"> - ROUND: 4</div>
<div class="line">   * Load Detection time: 330047 us (8 reads)</div>
<div class="line">   * Ramp up time: 1010776 us (25 reads)</div>
<div class="line">   * Ramp down time: 1281343 us (32 reads)</div>
</div><!-- fragment --><p>The "Load Detection time" is the time it takes for the JSY to see a load <code>&gt; 0</code> just after the relay was closed on a constant resistive load.</p>
<p>The "Ramp up time" is the time it takes for the JSY to stabilize (with a maximum delta of 1% from last measurement) and see an expected load value.</p>
<p>The "Ramp down time" is the time it takes for the JSY to return to 0W after the relay was opened.</p>
<p><b>What these results mean ?</b></p>
<ul>
<li>Speed up the JSY allows to <b>read data faster</b> and consequently block less the program if not using any dedicated task to read the JSY</li>
<li>It takes <b>more than 300 ms</b> for the JSY to report a change of a load appearing on the wire. So if you read the JSY each 300 ms, it can take up to 600 ms to see a change if you miss it. Reading the JSY more frequently (in a async loop) and faster will allow a change to be seen as fast as possible, but it will still take at least 300 ms for the change to be seen. <b>The best reactivity is achieved when reading the JSY in a loop at 38400 bauds, when the detection time is around 330 ms and quite consistent.</b></li>
<li>It takes <b>more than 1 second</b> for the JSY to report a load value which is stable and according to what we expect. This duration contains the duration for the load to reach its nominal power, plus the duration it takes for the JSY to stabilize its measurements (I think the JSY is using some kind of filtering or averaging).</li>
<li>Reading the JSY too frequently will lead to the same results, so an improvement could be to have the JSY read in a dedicated task asynchronously and use the callback mechanism to be called as soon as the JSY sees a change</li>
</ul>
<h1>Reference material</h1>
<ul>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY1031.pdf">JSY1031.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-163T.pdf">JSY-MK-163T.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-193.pdf">JSY-MK-193.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-194T.pdf">JSY-MK-194T.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-194T_Manual.pdf">JSY-MK-194T_Manual.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-194G.pdf">JSY-MK-194G.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-227.pdf">JSY-MK-227.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-229.pdf">JSY-MK-229.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-333.pdf">JSY-MK-333.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/JSY-MK-333G.pdf">JSY-MK-333G.pdf</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/RENERGY-RN8209G.pdf">RENERGY RN8209G</a></li>
<li><a href="https://mathieu.carbou.me/MycilaJSY/RENERGY-RN8302B.pdf">RENERGY RN8302B</a></li>
<li><a href="https://github.com/SciFiDryer/ModbusMechanic">ModbusMechanic</a> (can connect and configure JSY with a USB-TTL adapter) </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
